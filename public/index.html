<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Charged Up Properties â€“ Inventory</title>

<style>
:root{
  --red:#c62828;
  --black:#0b0b0b;
  --card:#151515;
  --border:#2b2b2b;
  --text:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--black);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
}
header{
  background:var(--red);
  padding:22px;
  text-align:center;
  font-size:26px;
  font-weight:bold;
}
.container{
  max-width:1500px;
  margin:auto;
  padding:30px 20px 60px;
}

/* FORM */
form{
  background:var(--card);
  padding:25px;
  border-radius:14px;
  margin-bottom:40px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}
label{font-size:13px;opacity:.9}
input,textarea,select{
  width:100%;
  padding:10px;
  margin-top:5px;
  background:#101010;
  color:#fff;
  border:1px solid var(--border);
  border-radius:6px;
}
textarea{min-height:100px}
button{
  background:var(--red);
  border:none;
  padding:11px 20px;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}
button:hover{background:#a61f1f}

/* PREVIEWS */
.preview-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
.preview{
  width:140px;
  height:100px;
  position:relative;
  cursor:grab;
}
.preview.dragging{
  opacity:.3;
}
.preview img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:8px;
  border:1px solid var(--border);
  pointer-events:none; /* ðŸ”¥ CRITICAL */
}
.preview .remove{
  position:absolute;
  top:-6px;
  right:-6px;
  background:#000;
  border:1px solid #444;
  font-size:11px;
  padding:3px 6px;
  color:#fff;
  cursor:pointer;
  pointer-events:auto;
}

/* INVENTORY */
.inventory-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(340px,1fr));
  gap:25px;
}
.card{
  background:var(--card);
  border-radius:14px;
  overflow:hidden;
}
.card .cover-wrap{
  height:190px;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card img.cover{
  max-height:100%;
  max-width:100%;
  object-fit:contain;
  cursor:pointer;
}
.card-body{padding:16px}
.price{color:var(--red);font-weight:bold;margin:6px 0}
.meta{font-size:13px;opacity:.85;margin-bottom:6px}
.actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}

/* MODAL */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:999;
  align-items:center;
  justify-content:center;
  cursor:zoom-in;
}
#modal img{
  max-width:96%;
  max-height:96%;
  transition:transform .2s ease;
}
#modal span{
  position:absolute;
  font-size:44px;
  cursor:pointer;
}
.close{top:20px;right:30px}
.prev{left:20px}
.next{right:20px}
.zoom-level{
  position:absolute;
  top:25px;
  left:25px;
  background:rgba(0,0,0,.5);
  padding:4px 8px;
  border-radius:6px;
}
</style>
</head>

<body>

<header>Charged Up Properties â€“ Inventory</header>

<div class="container">

<form id="propertyForm">
<input type="hidden" id="propertyId">

<div class="grid">
  <div><label>Name<input id="name" required></label></div>
  <div><label>Price<input id="price" type="number"></label></div>
  <div><label>Status<select id="status"><option>For Sale</option><option>Pending</option><option>Sold</option></select></label></div>
  <div><label>Address<input id="address"></label></div>
</div>

<label>Cover Image<input type="file" id="coverImage"></label>
<div id="coverPreview" class="preview-row"></div>

<label>Gallery Images (drag to reorder)<input type="file" id="galleryImages" multiple></label>
<div id="galleryPreview" class="preview-row"></div>

<button type="submit">Save Property</button>
</form>

<div id="inventory" class="inventory-grid"></div>
</div>

<div id="modal">
  <span class="close">&times;</span>
  <span class="prev">&#10094;</span>
  <img id="modalImg">
  <span class="next">&#10095;</span>
  <div class="zoom-level" id="zoomLevel">2x</div>
</div>

<script>
/* ===============================
   DRAG REORDER (FIXED)
================================ */
function enableDrag(container){
  let dragged=null;

  container.querySelectorAll(".preview").forEach(item=>{
    item.draggable=true;

    item.addEventListener("dragstart",e=>{
      dragged=item;
      item.classList.add("dragging");
      e.dataTransfer.setDragImage(new Image(),0,0);
    });

    item.addEventListener("dragend",()=>{
      item.classList.remove("dragging");
      dragged=null;
    });
  });

  container.addEventListener("dragover",e=>{
    e.preventDefault();
    const after=getDragAfter(container,e.clientX);
    if(after==null){
      container.appendChild(dragged);
    }else{
      container.insertBefore(dragged,after);
    }
  });
}

function getDragAfter(container,x){
  const els=[...container.querySelectorAll(".preview:not(.dragging)")];
  return els.reduce((closest,child)=>{
    const box=child.getBoundingClientRect();
    const offset=x-box.left-box.width/2;
    if(offset<0 && offset>closest.offset){
      return {offset,element:child};
    }else{
      return closest;
    }
  },{offset:-Infinity}).element;
}

/* ===============================
   PREVIEW CREATION
================================ */
function addGalleryPreview(src){
  const div=document.createElement("div");
  div.className="preview";
  div.innerHTML=`<img src="${src}"><span class="remove">&times;</span>`;
  div.querySelector(".remove").onclick=()=>div.remove();
  div.onclick=()=>openModal(src,[...galleryPreview.querySelectorAll("img")].map(i=>i.src));
  galleryPreview.appendChild(div);
  enableDrag(galleryPreview);
}

galleryImages.onchange=()=>{
  [...galleryImages.files].forEach(f=>{
    const r=new FileReader();
    r.onload=e=>addGalleryPreview(e.target.result);
    r.readAsDataURL(f);
  });
};

/* ===============================
   MODAL + MAGNIFY
================================ */
let zoom=2,magnified=false;
const modal=document.getElementById("modal");
const modalImg=document.getElementById("modalImg");
const zoomLevel=document.getElementById("zoomLevel");

function openModal(src,list){
  modal.style.display="flex";
  modalImg.src=src;
  magnified=false;
  zoom=2;
  modalImg.style.transform="scale(1)";
  zoomLevel.style.display="none";
}
document.querySelector(".close").onclick=()=>modal.style.display="none";

modalImg.onclick=()=>{
  magnified=!magnified;
  modalImg.style.transform=magnified?`scale(${zoom})`:"scale(1)";
  zoomLevel.style.display=magnified?"block":"none";
};
modal.onmousemove=e=>{
  if(!magnified) return;
  const r=modalImg.getBoundingClientRect();
  modalImg.style.transformOrigin=`${(e.clientX-r.left)/r.width*100}% ${(e.clientY-r.top)/r.height*100}%`;
};
modal.onwheel=e=>{
  if(!magnified) return;
  e.preventDefault();
  zoom=Math.min(5,Math.max(1,zoom+(e.deltaY<0?.2:-.2)));
  modalImg.style.transform=`scale(${zoom})`;
  zoomLevel.textContent=zoom.toFixed(1)+"x";
};
</script>
</body>
</html>
