<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Charged Up Properties – Inventory</title>

<style>
:root {
  --red:#c62828;
  --black:#0b0b0b;
  --card:#151515;
  --border:#2b2b2b;
  --text:#ffffff;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:var(--black);
  color:var(--text);
  font-family:Arial, Helvetica, sans-serif;
}

header {
  background:var(--red);
  padding:20px;
  text-align:center;
  font-size:24px;
  font-weight:bold;
}

.container {
  max-width:1400px;
  margin:auto;
  padding:30px 20px 60px;
}

/* ================= FORM ================= */

form {
  background:var(--card);
  padding:20px;
  border-radius:12px;
  margin-bottom:40px;
  box-shadow:0 15px 35px rgba(0,0,0,.5);
}

.grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px;
}

label {
  font-size:13px;
  opacity:.9;
}

input, textarea, select {
  width:100%;
  padding:10px;
  margin-top:5px;
  background:#101010;
  color:#fff;
  border:1px solid var(--border);
  border-radius:6px;
}

textarea { min-height:90px; }

button {
  background:var(--red);
  border:none;
  padding:10px 18px;
  color:#fff;
  border-radius:6px;
  cursor:pointer;
}

button:hover { background:#a61f1f; }

.preview-row {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}

.preview {
  position:relative;
}

.preview img {
  width:120px;
  height:90px;
  object-fit:cover;
  border-radius:6px;
  border:1px solid var(--border);
  cursor:pointer;
}

.preview .remove {
  position:absolute;
  top:-6px;
  right:-6px;
  background:#000;
  border:1px solid #444;
  font-size:11px;
  padding:2px 6px;
}

/* ================= INVENTORY ================= */

.inventory-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:25px;
}

.card {
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
}

.card img.cover {
  width:100%;
  height:180px;
  object-fit:cover;
  cursor:pointer;
}

.card-body {
  padding:15px;
}

.price {
  color:var(--red);
  margin:5px 0;
}

.meta {
  font-size:13px;
  opacity:.85;
  margin-bottom:8px;
}

.gallery-grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:6px;
}

.gallery-grid img {
  width:100%;
  height:70px;
  object-fit:cover;
  border-radius:6px;
  cursor:pointer;
}

.actions {
  display:flex;
  gap:10px;
  margin-top:12px;
}

/* ================= MODAL ================= */

#modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:999;
  align-items:center;
  justify-content:center;
}

#modal img {
  max-width:95%;
  max-height:95%;
}

#modal span {
  position:absolute;
  font-size:40px;
  cursor:pointer;
  user-select:none;
}

.close { top:20px; right:30px; }
.prev { left:20px; }
.next { right:20px; }
</style>
</head>

<body>

<header>Charged Up Properties – Inventory</header>

<div class="container">

<form id="propertyForm">
<input type="hidden" id="propertyId">

<div class="grid">
  <div><label>Name<input id="name" required></label></div>
  <div><label>Price<input id="price" type="number"></label></div>
  <div><label>Status<select id="status">
    <option>For Sale</option>
    <option>Pending</option>
    <option>Sold</option>
  </select></label></div>
  <div><label>Beds<input id="beds" type="number"></label></div>
  <div><label>Baths<input id="baths" type="number" step="0.5"></label></div>
  <div><label>Sq Ft<input id="sqft" type="number"></label></div>
  <div><label>Basement<select id="basement">
    <option value="No">No</option>
    <option value="Yes">Yes</option>
  </select></label></div>
</div>

<label>Description<textarea id="description"></textarea></label>

<label>Cover Image<input type="file" id="coverImage"></label>
<div id="coverPreview" class="preview-row"></div>

<label>Gallery Images<input type="file" id="galleryImages" multiple></label>
<div id="galleryPreview" class="preview-row"></div>

<button type="submit">Save Property</button>
</form>

<div class="inventory-grid" id="inventory"></div>

</div>

<!-- MODAL -->
<div id="modal">
  <span class="close">&times;</span>
  <span class="prev">&#10094;</span>
  <img id="modalImg">
  <span class="next">&#10095;</span>
</div>

<script>
const API="https://charged-up-properties-backend.onrender.com/api/properties";
let data=[], modalImgs=[], modalIndex=0;
let removedGallery=[], removeCover=false;

const modal=document.getElementById("modal");
const modalImg=document.getElementById("modalImg");

function openModal(arr,i){
  modalImgs=arr;
  modalIndex=i;
  modalImg.src=arr[i];
  modal.style.display="flex";
}
document.querySelector(".close").onclick=()=>modal.style.display="none";
document.querySelector(".prev").onclick=()=>navigate(-1);
document.querySelector(".next").onclick=()=>navigate(1);

function navigate(d){
  modalIndex=(modalIndex+d+modalImgs.length)%modalImgs.length;
  modalImg.src=modalImgs[modalIndex];
}

async function load(){
  const res=await fetch(API);
  data=await res.json();
  const el=document.getElementById("inventory");
  el.innerHTML="";
  data.forEach((p,i)=>{
    const gallery=(p.gallery_images||[]).filter(Boolean);
    el.innerHTML+=`
    <div class="card">
      ${p.cover_image?`<img class="cover" src="${p.cover_image}" onclick='openModal(["${p.cover_image}"],0)'>`:""}
      <div class="card-body">
        <strong>${p.name}</strong>
        <div class="price">$${p.price}</div>
        <div class="meta">${p.beds} bd | ${p.baths} ba | ${p.sqft} sqft | Basement: ${p.basement}</div>
        <div class="gallery-grid">
          ${gallery.map((g,j)=>`<img src="${g}" onclick='openModal(${JSON.stringify(gallery)},${j})'>`).join("")}
        </div>
        <div class="actions">
          <button onclick="edit(${i})">Edit</button>
          <button onclick="del(${p.id})">Delete</button>
        </div>
      </div>
    </div>`;
  });
}

function edit(i){
  removedGallery=[]; removeCover=false;
  const p=data[i];
  propertyId.value=p.id;
  name.value=p.name;
  price.value=p.price;
  status.value=p.status;
  beds.value=p.beds;
  baths.value=p.baths;
  sqft.value=p.sqft;
  basement.value=p.basement;
  description.value=p.description;

  coverPreview.innerHTML=p.cover_image?`
    <div class="preview">
      <img src="${p.cover_image}">
      <button class="remove" onclick="removeCover=true;this.parentElement.remove()">X</button>
    </div>`:"";

  galleryPreview.innerHTML=(p.gallery_images||[]).filter(Boolean).map(g=>`
    <div class="preview">
      <img src="${g}">
      <button class="remove" onclick='removedGallery.push("${g}");this.parentElement.remove()'>X</button>
    </div>`).join("");
}

async function del(id){
  if(confirm("Delete property?")){
    await fetch(`${API}/${id}`,{method:"DELETE"});
    load();
  }
}

propertyForm.onsubmit=async e=>{
  e.preventDefault();
  const fd=new FormData();
  ["name","price","status","beds","baths","sqft","basement","description"]
    .forEach(k=>fd.append(k,window[k].value));
  if(coverImage.files[0]) fd.append("coverImage",coverImage.files[0]);
  [...galleryImages.files].forEach(f=>fd.append("galleryImages",f));
  if(removeCover) fd.append("removeCover","true");
  removedGallery.forEach(g=>fd.append("removeGallery",g));

  const id=propertyId.value;
  await fetch(id?`${API}/${id}`:API,{method:id?"PUT":"POST",body:fd});
  propertyForm.reset();
  coverPreview.innerHTML=galleryPreview.innerHTML="";
  load();
};

load();
</script>
</body>
</html>
