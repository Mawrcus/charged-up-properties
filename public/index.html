<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Charged Up Properties Admin</title>

<style>
:root {
  --red:#d32f2f;
  --dark:#0e0e0e;
  --card:#161616;
  --border:#2a2a2a;
  --text:#ffffff;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:var(--dark);
  color:var(--text);
  font-family:Arial, Helvetica, sans-serif;
}

h1 {
  text-align:center;
  color:var(--red);
  margin:25px 0;
}

.container {
  max-width:1400px;
  margin:auto;
  padding:0 20px 60px;
}

/* ================= FORM ================= */

form {
  background:var(--card);
  border-radius:12px;
  padding:20px;
  margin-bottom:40px;
  box-shadow:0 10px 30px rgba(0,0,0,.4);
}

label { margin-top:12px; display:block; font-size:14px; }

input, textarea, select {
  width:100%;
  margin-top:5px;
  padding:10px;
  background:#111;
  color:#fff;
  border:1px solid var(--border);
  border-radius:6px;
}

button {
  background:var(--red);
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:6px;
  cursor:pointer;
  margin-top:15px;
}

button:hover { background:#b71c1c; }

.preview-row {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}

.preview {
  position:relative;
}

.preview img {
  height:90px;
  width:120px;
  object-fit:cover;
  border-radius:6px;
  border:1px solid var(--border);
}

.preview button {
  position:absolute;
  top:-6px;
  right:-6px;
  padding:2px 6px;
  font-size:12px;
}

/* ================= INVENTORY GRID ================= */

.inventory-grid {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:25px;
}

.card {
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 10px 25px rgba(0,0,0,.4);
}

.card-cover {
  width:100%;
  height:190px;
  background:#000;
}

.card-cover img {
  width:100%;
  height:100%;
  object-fit:cover;
  cursor:pointer;
}

.card-body {
  padding:15px;
}

.card-title {
  font-size:18px;
  font-weight:bold;
}

.card-price {
  color:var(--red);
  margin:5px 0 10px;
}

.gallery-grid {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:6px;
}

.gallery-grid img {
  height:70px;
  width:100%;
  object-fit:cover;
  border-radius:6px;
  cursor:pointer;
  border:1px solid var(--border);
}

.card-actions {
  margin-top:12px;
  display:flex;
  gap:10px;
}

/* ================= MODAL ================= */

.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.95);
  z-index:999;
  align-items:center;
  justify-content:center;
}

.modal img {
  max-width:95%;
  max-height:95%;
}

.modal span {
  position:absolute;
  color:#fff;
  font-size:40px;
  cursor:pointer;
  user-select:none;
}

.close { top:20px; right:30px; }
.prev { left:20px; }
.next { right:20px; }

</style>
</head>

<body>

<h1>Charged Up Properties Admin</h1>

<div class="container">

<form id="propertyForm">
<input type="hidden" id="propertyId">

<label>Name</label><input id="name" required>
<label>Price</label><input id="price" type="number" required>
<label>Status</label>
<select id="status">
  <option>For Sale</option>
  <option>Pending</option>
  <option>Sold</option>
</select>
<label>Description</label><textarea id="description"></textarea>

<label>Cover Image</label>
<input type="file" id="coverImage">
<div class="preview-row" id="coverPreview"></div>

<label>Gallery Images</label>
<input type="file" id="galleryImages" multiple>
<div class="preview-row" id="galleryPreview"></div>

<button type="submit">Save Property</button>
</form>

<h2>Current Inventory</h2>
<div class="inventory-grid" id="propertyList"></div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <span class="close">&times;</span>
  <span class="prev">&#10094;</span>
  <img id="modalImg">
  <span class="next">&#10095;</span>
</div>

<script>
const API = "https://charged-up-properties-backend.onrender.com/api/properties";
let properties=[], modalIndex=0, modalImages=[];

const modal=document.getElementById("modal");
const modalImg=document.getElementById("modalImg");

function openModal(images,i){
  modalImages=images.filter(Boolean);
  modalIndex=i;
  modalImg.src=modalImages[modalIndex];
  modal.style.display="flex";
}
document.querySelector(".close").onclick=()=>modal.style.display="none";
document.querySelector(".prev").onclick=()=>change(-1);
document.querySelector(".next").onclick=()=>change(1);
document.addEventListener("keydown",e=>{ if(e.key==="Escape") modal.style.display="none"; });

function change(d){
  modalIndex=(modalIndex+d+modalImages.length)%modalImages.length;
  modalImg.src=modalImages[modalIndex];
}

async function loadProperties(){
  const res=await fetch(API);
  properties=await res.json();
  const list=document.getElementById("propertyList");
  list.innerHTML="";
  properties.forEach((p,i)=>{
    const card=document.createElement("div");
    card.className="card";

    const gallery=(p.gallery_images||[]).filter(Boolean);

    card.innerHTML=`
      <div class="card-cover">
        ${p.cover_image?`<img src="${p.cover_image}" onclick='openModal(["${p.cover_image}"],0)'>`:""}
      </div>
      <div class="card-body">
        <div class="card-title">${p.name}</div>
        <div class="card-price">$${p.price}</div>
        <div class="gallery-grid">
          ${gallery.map((g,j)=>`<img src="${g}" onclick='openModal(${JSON.stringify(gallery)},${j})'>`).join("")}
        </div>
        <div class="card-actions">
          <button onclick="editProperty(${i})">Edit</button>
          <button onclick="deleteProperty(${p.id})">Delete</button>
        </div>
      </div>`;
    list.appendChild(card);
  });
}

async function deleteProperty(id){
  if(confirm("Delete property?")){
    await fetch(`${API}/${id}`,{method:"DELETE"});
    loadProperties();
  }
}

function editProperty(i){
  const p=properties[i];
  propertyId.value=p.id;
  name.value=p.name;
  price.value=p.price;
  status.value=p.status;
  description.value=p.description;

  coverPreview.innerHTML=p.cover_image?`
    <div class="preview"><img src="${p.cover_image}"></div>`:"";

  galleryPreview.innerHTML=(p.gallery_images||[]).filter(Boolean)
    .map(g=>`<div class="preview"><img src="${g}"></div>`).join("");
}

propertyForm.onsubmit=async e=>{
  e.preventDefault();
  const fd=new FormData();
  ["name","price","status","description"].forEach(id=>fd.append(id,window[id].value));
  if(coverImage.files[0]) fd.append("coverImage",coverImage.files[0]);
  [...galleryImages.files].forEach(f=>fd.append("galleryImages",f));
  const id=propertyId.value;
  await fetch(id?`${API}/${id}`:API,{method:id?"PUT":"POST",body:fd});
  propertyForm.reset();
  coverPreview.innerHTML=galleryPreview.innerHTML="";
  loadProperties();
};

loadProperties();
</script>
</body>
</html>
